<!DOCTYPE html>
<html lang="oyo" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.88.1" />
    <meta name="description" content="AWS Modernization Workshop with Kong">
<meta name="author" content="Eugene Mu, Thomas McGonagle, Peter Blinstrubas">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Prometheus and Grafana :: Self-Paced</title>

    
    <link href="/css/nucleus.css?1633693366" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1633693366" rel="stylesheet">
    <link href="/css/hybrid.css?1633693366" rel="stylesheet">
    <link href="/css/featherlight.min.css?1633693366" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1633693366" rel="stylesheet">
    <link href="/css/auto-complete.css?1633693366" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1633693366" rel="stylesheet">
    <link href="/css/theme.css?1633693366" rel="stylesheet">
    <link href="/css/tabs.css?1633693366" rel="stylesheet">
    <link href="/css/hugo-theme.css?1633693366" rel="stylesheet">
    
    <link href="/css/theme-mine.css?1633693366" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1633693366"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <script type="text/javascript">
    (function() {
          var didInit = false;
          function initMunchkin() {
              if (didInit === false) {
                didInit = true;
                Munchkin.init("112-TZM-766", { domainLevel: 3 });
              }
          }
          var s = document.createElement('script');
          s.type = 'text/javascript';
          s.async = true;
          s.src = '//munchkin.marketo.net/munchkin.js';
          s.onreadystatechange = function() {
              if (this.readyState == 'complete' || this.readyState == 'loaded') {
                  initMunchkin();
              }
          };
          s.onload = initMunchkin;
          document.getElementsByTagName('head')[0].appendChild(s);
    })();
</script>

<link rel="stylesheet" href="/css/mp-devops-series.css">
<link rel="stylesheet" href="https://pages.awscloud.com/js/forms2/css/forms2.css">

  </head>
  <body class="" data-url="/040_kong_enterprise_setup/043_prometheus_grafana.html">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a href="/" title="Go home"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 30" width="60%" style="padding:20px 0px;"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg></a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1633693366"></script>
<script type="text/javascript" src="/js/auto-complete.js?1633693366"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1633693366"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/010_introduction.html" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="/010_introduction.html">
          Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/10_foreword.html" title="Foreword" class="dd-item ">
        <a href="/010_introduction/10_foreword.html">
        Foreword
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/12_problem_to_solve.html" title="The Challenge" class="dd-item ">
        <a href="/010_introduction/12_problem_to_solve.html">
        The Challenge
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/14_partner.html" title="What is Kong?" class="dd-item ">
        <a href="/010_introduction/14_partner.html">
        What is Kong?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/16_workshop_prerequisites.html" title="Workshop Prerequisites" class="dd-item ">
        <a href="/010_introduction/16_workshop_prerequisites.html">
        Workshop Prerequisites
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/18_getting_started.html" title="Getting Started" class="dd-item ">
        <a href="/010_introduction/18_getting_started.html">
        Getting Started
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/020_event_engine_setup.html" title="Event Engine Setup" class="dd-item
        
        
        
        ">
      <a href="/020_event_engine_setup.html">
          Event Engine Setup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/020_event_engine_setup/20_aws_event_engine.html" title="1. AWS Event Engine" class="dd-item ">
        <a href="/020_event_engine_setup/20_aws_event_engine.html">
        1. AWS Event Engine
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/020_event_engine_setup/22_setup_eks.html" title="2. Set up EKS Cluster" class="dd-item ">
        <a href="/020_event_engine_setup/22_setup_eks.html">
        2. Set up EKS Cluster
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/030_aws_setup_for_hosting_kong.html" title="AWS Setup for Hosting Kong" class="dd-item
        
        
        
        ">
      <a href="/030_aws_setup_for_hosting_kong.html">
          AWS Setup for Hosting Kong
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/030_aws_setup_for_hosting_kong/30_provisiong_eks_infrastructure.html" title="Provisioning EKS infrastructure" class="dd-item ">
        <a href="/030_aws_setup_for_hosting_kong/30_provisiong_eks_infrastructure.html">
        Provisioning EKS infrastructure
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/040_kong_enterprise_setup.html" title="Kong Konnect Enterprise Set Up" class="dd-item
        parent
        
        
        ">
      <a href="/040_kong_enterprise_setup.html">
          Kong Konnect Enterprise Set Up
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/041_data_plane_and_control_plane_setup.html" title="Konnect Control Plane and Data Plane Setup" class="dd-item ">
        <a href="/040_kong_enterprise_setup/041_data_plane_and_control_plane_setup.html">
        Konnect Control Plane and Data Plane Setup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/042_hpa.html" title="Konnect Data Plane Elasticity" class="dd-item ">
        <a href="/040_kong_enterprise_setup/042_hpa.html">
        Konnect Data Plane Elasticity
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/043_prometheus_grafana.html" title="Prometheus and Grafana" class="dd-item active">
        <a href="/040_kong_enterprise_setup/043_prometheus_grafana.html">
        Prometheus and Grafana
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/044_elk.html" title="ELK Stack" class="dd-item ">
        <a href="/040_kong_enterprise_setup/044_elk.html">
        ELK Stack
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/045_redis.html" title="Redis" class="dd-item ">
        <a href="/040_kong_enterprise_setup/045_redis.html">
        Redis
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/046_sample_application.html" title="Sample App Installation" class="dd-item ">
        <a href="/040_kong_enterprise_setup/046_sample_application.html">
        Sample App Installation
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/047_simple_kong_ingress.html" title="Simple Kong Ingress" class="dd-item ">
        <a href="/040_kong_enterprise_setup/047_simple_kong_ingress.html">
        Simple Kong Ingress
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/050_kong_ingress_consumption_monitoring.html" title="Kong Ingress Consumption and Monitoring" class="dd-item
        
        
        
        ">
      <a href="/050_kong_ingress_consumption_monitoring.html">
          Kong Ingress Consumption and Monitoring
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/050_kong_ingress_consumption_monitoring/051_prometheus_grafana.html" title="Prometheus and Grafana" class="dd-item ">
        <a href="/050_kong_ingress_consumption_monitoring/051_prometheus_grafana.html">
        Prometheus and Grafana
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/050_kong_ingress_consumption_monitoring/052_elk.html" title="ELK" class="dd-item ">
        <a href="/050_kong_ingress_consumption_monitoring/052_elk.html">
        ELK
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/060_kong_ingress.html" title="Kong Ingress Controller Policies" class="dd-item
        
        
        
        ">
      <a href="/060_kong_ingress.html">
          Kong Ingress Controller Policies
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/061_cache.html" title="Proxy Caching" class="dd-item ">
        <a href="/060_kong_ingress/061_cache.html">
        Proxy Caching
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/063_rate_limiting.html" title="Rate Limiting Policy Definition" class="dd-item ">
        <a href="/060_kong_ingress/063_rate_limiting.html">
        Rate Limiting Policy Definition
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/064_api_key.html" title="API Key Policy Definition" class="dd-item ">
        <a href="/060_kong_ingress/064_api_key.html">
        API Key Policy Definition
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/065_ingress_rule.html" title="Set up Ingress rule for Kong Ingress" class="dd-item ">
        <a href="/060_kong_ingress/065_ingress_rule.html">
        Set up Ingress rule for Kong Ingress
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/066_fallback_service.html" title="Configuring a fallback service" class="dd-item ">
        <a href="/060_kong_ingress/066_fallback_service.html">
        Configuring a fallback service
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/067_https_redirect.html" title="HTTP/S Redirect" class="dd-item ">
        <a href="/060_kong_ingress/067_https_redirect.html">
        HTTP/S Redirect
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/068_redis_ratelimiting.html" title="Redis for Rate Limiting" class="dd-item ">
        <a href="/060_kong_ingress/068_redis_ratelimiting.html">
        Redis for Rate Limiting
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/070_kong_cognito.html" title="Kong and AWS Cognito" class="dd-item
        
        
        
        ">
      <a href="/070_kong_cognito.html">
          Kong and AWS Cognito
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/070_kong_cognito/071_cognito.html" title="AWS Cognito" class="dd-item ">
        <a href="/070_kong_cognito/071_cognito.html">
        AWS Cognito
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/070_kong_cognito/073_oidc_plugin.html" title="OpenId Connect Plugin" class="dd-item ">
        <a href="/070_kong_cognito/073_oidc_plugin.html">
        OpenId Connect Plugin
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/090_cleanup.html" title="Cleanup" class="dd-item
        
        
        
        ">
      <a href="/090_cleanup.html">
          Cleanup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3></h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://awsworkshop.io"><i class='fas fa-graduation-cap'></i> Modernization Workshops</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/builders-library/"><i class='fas fa-tools'></i> AWS Builders Library</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/blogs/modernizing-with-aws/"><i class='far fa-lightbulb'></i> Modernization with AWS</a>
              </li>
          
              <li>
                  <a class="padding" href="https://eksworkshop.com/"><i class='fas fa-chalkboard-teacher'></i> EKS Workshop</a>
              </li>
          
              <li>
                  <a class="padding" href="https://ecsworkshop.com/"><i class='fas fa-chalkboard-teacher'></i> ECS Workshop</a>
              </li>
          
              <li>
                  <a class="padding" href="https://www.appmeshworkshop.com/"><i class='fas fa-chalkboard-teacher'></i> App Mesh Workshop</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="oyo" value="/040_kong_enterprise_setup/043_prometheus_grafana.html" selected>Self-Paced</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      

      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> </a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>

    <a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a
        href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | © 2020, Amazon Web Services, Inc. or its
    affiliates. All rights reserved.

</left>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>AWS Modernization Workshop</a> > <a href='/040_kong_enterprise_setup.html'>Kong Konnect Enterprise Set Up</a> > Prometheus and Grafana
          
        
          
        
          
        
                 
                  </span>
                </div>
                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
          <div id="chapter">
        
        <div id="body-inner">
          

        




<h1 id="prometheus-and-grafana">Prometheus and Grafana</h1>

<p>From the Observability perspective, we&rsquo;re going to use Prometheus and Grafana. Two levels of monitoring are possible:<p></p>

<ul>
<li>Kubernetes monitoring: Prometheus and Grafana monitor Kong Data Plane Deployment in terms of CPU, memory and networking consumption as well as HPA and the number of Pod replicas, just like any Kubernetes Deployment.</li>
<li>Kong Data Plane monitoring: Prometheus and Grafana expose metrics the Kong Data Planes replicas provide in terms of API consumption including number of processed requests, etc.</li>
</ul>

<p>We&rsquo;re going to use <a href="https://github.com/prometheus-operator/prometheus-operator" target="_blank">Prometheus Operator</a> to address these two monitoring levels. Moreover, to support HPA from the Observability perspective, we&rsquo;re going to configure <a href="https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/user-guides/getting-started.md" target="_blank">Service Monitor</a> to monitor the variable number of Pod replicas.</p>

<h2 id="prometheus-operator">Prometheus Operator</h2>

<p>First of all, let&rsquo;s install Prometheus Operator with its specific Helm Charts. Note we&rsquo;re requesting Load Balancers to expose Prometheus, Grafana and Alert Manager UIs.</p>
<pre tabindex="0"><code>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts

helm repo update</code></pre><pre tabindex="0"><code>kubectl create namespace prometheus</code></pre><pre tabindex="0"><code>helm install prometheus -n prometheus prometheus-community/kube-prometheus-stack \
--set alertmanager.service.type=LoadBalancer \
--set prometheus.service.type=LoadBalancer \
--set grafana.service.type=LoadBalancer</code></pre>
<p>Use should see several new Pods and Services after the installations</p>
<pre tabindex="0"><code>$ kubectl get service -n prometheus
NAME                                      TYPE           CLUSTER-IP       EXTERNAL-IP                                                               PORT(S)                      AGE
alertmanager-operated                     ClusterIP      None             &lt;none&gt;                                                                    9093/TCP,9094/TCP,9094/UDP   55s
prometheus-grafana                        LoadBalancer   10.100.47.13     a5f6d918221a14383813bc2f6b88c6c4-2050279250.us-east-1.elb.amazonaws.com   80:31877/TCP                 59s
prometheus-kube-prometheus-alertmanager   LoadBalancer   10.100.18.20     acb89669ac9a1432b81c25d418832f84-579800983.us-east-1.elb.amazonaws.com    9093:32325/TCP               59s
prometheus-kube-prometheus-operator       ClusterIP      10.100.118.126   &lt;none&gt;                                                                    443/TCP                      59s
prometheus-kube-prometheus-prometheus     LoadBalancer   10.100.19.126    a9a5daa0ee24243dabd0d771f77df7c7-832896403.us-east-1.elb.amazonaws.com    9090:31784/TCP               59s
prometheus-kube-state-metrics             ClusterIP      10.100.254.140   &lt;none&gt;                                                                    8080/TCP                     59s
prometheus-operated                       ClusterIP      None             &lt;none&gt;                                                                    9090/TCP                     55s
prometheus-prometheus-node-exporter       ClusterIP      10.100.8.65      &lt;none&gt;                                                                    9100/TCP                     59s</code></pre><pre tabindex="0"><code>$ kubectl get pod -n prometheus
NAME                                                     READY   STATUS    RESTARTS   AGE
alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   0          86s
prometheus-grafana-756d9b8485-769kp                      2/2     Running   0          89s
prometheus-kube-prometheus-operator-686b89b849-4v25b     1/1     Running   0          90s
prometheus-kube-state-metrics-58c5cd6ddb-mhjpt           1/1     Running   0          90s
prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   0          86s
prometheus-prometheus-node-exporter-8qddg                1/1     Running   0          90s</code></pre>
<h3 id="check-prometheus">Check Prometheus</h3>

<p>Get the Prometheus&rsquo; Load Balancer address
<pre>
$ kubectl get service prometheus-kube-prometheus-prometheus -n prometheus --output=jsonpath=&lsquo;{.status.loadBalancer.ingress[0].hostname}&rsquo;
a9a5daa0ee24243dabd0d771f77df7c7-832896403.us-east-1.elb.amazonaws.com
</pre></p>

<p>Redirect your browser to <a href="http://a9a5daa0ee24243dabd0d771f77df7c7-832896403.us-east-1.elb.amazonaws.com:9090" target="_blank">http://a9a5daa0ee24243dabd0d771f77df7c7-832896403.us-east-1.elb.amazonaws.com:9090</a></p>

<p><img src="/images/prometheus.png" alt="prometheus" /></p>

<h3 id="check-grafana">Check Grafana</h3>

<p>Do the same thing for Grafana
<pre>
$ kubectl get service prometheus-grafana -n prometheus --output=jsonpath=&lsquo;{.status.loadBalancer.ingress[0].hostname}&rsquo;
a5f6d918221a14383813bc2f6b88c6c4-2050279250.us-east-1.elb.amazonaws.com
</pre></p>

<p>Get Grafana admin&rsquo;s password:
<pre>
$ kubectl get secret prometheus-grafana -n prometheus -o jsonpath=&ldquo;{.data.admin-password}&rdquo; | base64 &ndash;decode ; echo
prom-operator
</pre></p>

<p>Redirect your browser to it: <a href="http://a5f6d918221a14383813bc2f6b88c6c4-2050279250.us-east-1.elb.amazonaws.com" target="_blank">http://a5f6d918221a14383813bc2f6b88c6c4-2050279250.us-east-1.elb.amazonaws.com</a>. Use the <b>admin</b> id with the password we got.</p>

<p><img src="/images/grafana.png" alt="grafana" /></p>

<h2 id="kong-data-plane-and-prometheus-service-monitor">Kong Data Plane and Prometheus Service Monitor</h2>

<p>In order to monitor the Kong Data Planes replicas we&rsquo;re going to configure a Service Monitor based on a Kubernetes Service created for the Data Planes. The diagram shows the topology:</p>

<h3 id="create-a-global-prometheus-plugin">Create a Global Prometheus plugin</h3>

<p>First of all we have to configure the specific Prometheus plugin provided by Kong. After submitting the following declaration, all Ingresses defined will have the plugin enabled and, therefore, include their metrics on the Prometheus endpoint exposed by the Kong Data Plane.</p>
<pre tabindex="0"><code>cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: configuration.konghq.com/v1
kind: KongClusterPlugin
metadata:
  name: prometheus
  annotations:
    kubernetes.io/ingress.class: kong
  labels:
    global: &#34;true&#34;
plugin: prometheus
EOF</code></pre>
<h3 id="expose-the-data-plane-metrics-endpoint-with-a-kubernetes-service">Expose the Data Plane metrics endpoint with a Kubernetes Service</h3>

<p>The next thing to do is to expose the Data Plane metrics port as a new Kubernetes Service. The new Kubernetes Service will be consumed by the Prometheus Service Monitor we&rsquo;re going to configure later.</p>

<p>The new Kubernetes Service will be based on the metrics port 8100 provided by the Data Plane. We set the port during the Data Plane installation using the parameter <b>--set env.status_listen=0.0.0.0:8100</b>. You can check the port running:</p>
<pre tabindex="0"><code>$ kubectl describe pod kong-dp-kong -n kong-dp | grep Ports
    Ports:          8000/TCP, 8443/TCP, 8100/TCP
    Host Ports:     0/TCP, 0/TCP, 0/TCP</code></pre>
<p>Here&rsquo;s the new Kubernetes Service declaration:</p>
<pre tabindex="0"><code>cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: v1
kind: Service
metadata:
  name: kong-dp-monitoring
  namespace: kong-dp
  labels:
    app: kong-dp-monitoring
spec:
  selector:
    app.kubernetes.io/name: kong
  type: ClusterIP
  ports:
  - name: metrics
    protocol: TCP
    port: 8100
    targetPort: 8100
EOF</code></pre>
<p>Note that the new Kubernetes Service is selecting the existing Data Plane Kubernetes Service using its specific label <b>app.kubernetes.io/name: kong</b></p>

<p>Use can check the label running:</p>
<pre tabindex="0"><code>$ kubectl get service -n kong-dp -o wide
NAME                 TYPE           CLUSTER-IP       EXTERNAL-IP                                                               PORT(S)                      AGE   SELECTOR
kong-dp-kong-proxy   LoadBalancer   10.100.56.103    a946e3cab079a49a1b6661ab62d5585f-2135097986.us-east-1.elb.amazonaws.com   80:31032/TCP,443:30651/TCP   38m   app.kubernetes.io/component=app,app.kubernetes.io/instance=kong-dp,app.kubernetes.io/name=kong
kong-dp-monitoring   ClusterIP      10.100.170.163   &lt;none&gt;                                                                    8100/TCP                     6s    app.kubernetes.io/name=kong</code></pre>
<p>After submitting the declaration you should see the new Kubernetes Service:</p>
<pre tabindex="0"><code>$ kubectl get service -n kong-dp
NAME                 TYPE           CLUSTER-IP       EXTERNAL-IP                                                               PORT(S)                      AGE
kong-dp-kong-proxy   LoadBalancer   10.100.56.103    a946e3cab079a49a1b6661ab62d5585f-2135097986.us-east-1.elb.amazonaws.com   80:31032/TCP,443:30651/TCP   38m
kong-dp-monitoring   ClusterIP      10.100.170.163   &lt;none&gt;                                                                    8100/TCP                     34s</code></pre>
<h3 id="test-the-service">Test the service.</h3>

<p>On one local terminal, expose the port 8100 using <b>port-forward</b></p>
<pre tabindex="0"><code>$ kubectl port-forward service/kong-dp-monitoring -n kong-dp 8100
Forwarding from 127.0.0.1:8100 -&gt; 8100
Forwarding from [::1]:8100 -&gt; 8100</code></pre>
<p>On another terminal send a request to it:</p>

<pre>
$ http :8100/metrics
HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Connection: keep-alive
Content-Type: text/plain; charset=UTF-8
Date: Thu, 30 Sep 2021 15:25:09 GMT
Server: kong/2.5.1.0-enterprise-edition
Transfer-Encoding: chunked
X-Kong-Admin-Latency: 4
X-Kong-Status-Request-ID: QNX72r2DlUxloZaqoWkMIBBU0Rvug2Jg

# HELP kong_datastore_reachable Datastore reachable from Kong, 0 is unreachable
# TYPE kong_datastore_reachable gauge
kong_datastore_reachable 1
# HELP kong_enterprise_license_expiration Unix epoch time when the license expires, the timestamp is substracted by 24 hours to avoid difference in timezone
# TYPE kong_enterprise_license_expiration gauge
kong_enterprise_license_expiration 1653998400
# HELP kong_enterprise_license_features License features features
# TYPE kong_enterprise_license_features gauge
kong_enterprise_license_features{feature="ee_plugins"} 1
kong_enterprise_license_features{feature="write_admin_api"} 1
# HELP kong_enterprise_license_signature Last 32 bytes of the license signautre in number
# TYPE kong_enterprise_license_signature gauge
kong_enterprise_license_signature 3.5512300986528e+40
# HELP kong_memory_lua_shared_dict_bytes Allocated slabs in bytes in a shared_dict
# TYPE kong_memory_lua_shared_dict_bytes gauge
kong_memory_lua_shared_dict_bytes{shared_dict="kong",kong_subsystem="http"} 40960
………….
</pre>

<h3 id="create-the-prometheus-service-monitor">Create the Prometheus Service Monitor</h3>

<p>Now, let&rsquo;s create the Prometheus Service Monitor collecting metrics from all Data Planes instances. The Service Monitor is based on the new <b>kong-dp-monitoring</b> Kubernetes Service we created before:</p>
<pre tabindex="0"><code>cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: kong-dp-service-monitor
  namespace: kong-dp
  labels:
    release: kong-dp
spec:
  namespaceSelector:
    any: true
  endpoints:
  - port: metrics       
  selector:
    matchLabels:
      app: kong-dp-monitoring
EOF</code></pre>
<h3 id="starting-a-prometheus-instance-for-the-kong-data-plane">Starting a Prometheus instance for the Kong Data Plane</h3>

<p>A specific Prometheus instance will be created to monitor the Kong Data Plane using a specific &ldquo;kong-prometheus&rdquo; account. Before doing it, we need to create the account and grant specific permissions.</p>
<pre tabindex="0"><code>cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: v1
kind: ServiceAccount
metadata:
  name: kong-prometheus
  namespace: kong-dp
EOF</code></pre><pre tabindex="0"><code>cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRole
metadata:
  name: prometheus
rules:
- apiGroups: [&#34;&#34;]
  resources:
  - nodes
  - nodes/metrics
  - services
  - endpoints
  - pods
  verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;]
- apiGroups: [&#34;&#34;]
  resources:
  - configmaps
  verbs: [&#34;get&#34;]
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses
  verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;]
- nonResourceURLs: [&#34;/metrics&#34;]
  verbs: [&#34;get&#34;]
EOF</code></pre><pre tabindex="0"><code>cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRoleBinding
metadata:
  name: prometheus
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: prometheus
subjects:
- kind: ServiceAccount
  name: kong-prometheus
  namespace: kong-dp
EOF</code></pre>
<p>Instantiate a Prometheus Service for the Kong Data Plane</p>
<pre tabindex="0"><code>cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: monitoring.coreos.com/v1
kind: Prometheus
metadata:
  name: kong-dp-prometheus
  namespace: kong-dp
spec:
  serviceAccountName: kong-prometheus
  serviceMonitorSelector:
    matchLabels:
      release: kong-dp
  resources:
    requests:
      memory: 400Mi
  enableAdminAPI: true
EOF</code></pre>
<p>Check the Installation</p>
<pre tabindex="0"><code>$ kubectl get pod -n kong-dp
NAME                              READY   STATUS    RESTARTS   AGE
kong-dp-kong-67995ddc8c-4vhph     1/1     Running   0          13m
prometheus-kong-dp-prometheus-0   2/2     Running   0          43s</code></pre><pre tabindex="0"><code>$ kubectl get service -n kong-dp
NAME                  TYPE           CLUSTER-IP       EXTERNAL-IP                                                               PORT(S)                      AGE
kong-dp-kong-proxy    LoadBalancer   10.100.56.103    a946e3cab079a49a1b6661ab62d5585f-2135097986.us-east-1.elb.amazonaws.com   80:31032/TCP,443:30651/TCP   44m
kong-dp-monitoring    ClusterIP      10.100.170.163   &lt;none&gt;                                                                    8100/TCP                     6m38s
prometheus-operated   ClusterIP      None             &lt;none&gt;                                                                    9090/TCP                     4m12s</code></pre><pre tabindex="0"><code>$ kubectl get prometheus -n kong-dp
NAME                 VERSION   REPLICAS   AGE
kong-dp-prometheus                        4m8s</code></pre>
<p>Expose the new Prometheus service</p>
<pre tabindex="0"><code>$ kubectl expose service prometheus-operated --name prometheus-operated-lb --type=LoadBalancer -n kong-dp
service/prometheus-operated-lb exposed</code></pre><pre tabindex="0"><code>$ kubectl get service -n kong-dp
NAME                     TYPE           CLUSTER-IP       EXTERNAL-IP                                                               PORT(S)                      AGE
kong-dp-kong-proxy       LoadBalancer   10.100.56.103    a946e3cab079a49a1b6661ab62d5585f-2135097986.us-east-1.elb.amazonaws.com   80:31032/TCP,443:30651/TCP   45m
kong-dp-monitoring       ClusterIP      10.100.170.163   &lt;none&gt;                                                                    8100/TCP                     7m20s
prometheus-operated      ClusterIP      None             &lt;none&gt;                                                                    9090/TCP                     4m54s
prometheus-operated-lb   LoadBalancer   10.100.77.90     a81a086ab48e446d68c35d0bd0e93550-437150660.us-east-1.elb.amazonaws.com    9090:31798/TCP               14s</code></pre>

<footer class="footline">
	
</footer>

        
            </div> 
        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/040_kong_enterprise_setup/042_hpa.html" title="Konnect Data Plane Elasticity"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/040_kong_enterprise_setup/044_elk.html" title="ELK Stack" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1633693366"></script>
    <script src="/js/perfect-scrollbar.min.js?1633693366"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1633693366"></script>
    <script src="/js/jquery.sticky.js?1633693366"></script>
    <script src="/js/featherlight.min.js?1633693366"></script>
    <script src="/js/highlight.pack.js?1633693366"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1633693366"></script>
    <script src="/js/learn.js?1633693366"></script>
    <script src="/js/hugo-learn.js?1633693366"></script>
    
        
            <script src="/mermaid/mermaid.js?1633693366"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

