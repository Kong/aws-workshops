<!DOCTYPE html>
<html lang="oyo" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.88.1" />
    <meta name="description" content="AWS Modernization Workshop with Kong">
<meta name="author" content="Eugene Mu, Thomas McGonagle, Peter Blinstrubas">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Konnect Data Plane Elasticity :: Self-Paced</title>

    
    <link href="/css/nucleus.css?1633693366" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1633693366" rel="stylesheet">
    <link href="/css/hybrid.css?1633693366" rel="stylesheet">
    <link href="/css/featherlight.min.css?1633693366" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1633693366" rel="stylesheet">
    <link href="/css/auto-complete.css?1633693366" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1633693366" rel="stylesheet">
    <link href="/css/theme.css?1633693366" rel="stylesheet">
    <link href="/css/tabs.css?1633693366" rel="stylesheet">
    <link href="/css/hugo-theme.css?1633693366" rel="stylesheet">
    
    <link href="/css/theme-mine.css?1633693366" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1633693366"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <script type="text/javascript">
    (function() {
          var didInit = false;
          function initMunchkin() {
              if (didInit === false) {
                didInit = true;
                Munchkin.init("112-TZM-766", { domainLevel: 3 });
              }
          }
          var s = document.createElement('script');
          s.type = 'text/javascript';
          s.async = true;
          s.src = '//munchkin.marketo.net/munchkin.js';
          s.onreadystatechange = function() {
              if (this.readyState == 'complete' || this.readyState == 'loaded') {
                  initMunchkin();
              }
          };
          s.onload = initMunchkin;
          document.getElementsByTagName('head')[0].appendChild(s);
    })();
</script>

<link rel="stylesheet" href="/css/mp-devops-series.css">
<link rel="stylesheet" href="https://pages.awscloud.com/js/forms2/css/forms2.css">

  </head>
  <body class="" data-url="/040_kong_enterprise_setup/042_hpa.html">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a href="/" title="Go home"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 30" width="60%" style="padding:20px 0px;"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg></a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1633693366"></script>
<script type="text/javascript" src="/js/auto-complete.js?1633693366"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1633693366"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/010_introduction.html" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="/010_introduction.html">
          Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/10_foreword.html" title="Foreword" class="dd-item ">
        <a href="/010_introduction/10_foreword.html">
        Foreword
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/12_problem_to_solve.html" title="The Challenge" class="dd-item ">
        <a href="/010_introduction/12_problem_to_solve.html">
        The Challenge
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/14_partner.html" title="What is Kong?" class="dd-item ">
        <a href="/010_introduction/14_partner.html">
        What is Kong?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/16_workshop_prerequisites.html" title="Workshop Prerequisites" class="dd-item ">
        <a href="/010_introduction/16_workshop_prerequisites.html">
        Workshop Prerequisites
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/18_getting_started.html" title="Getting Started" class="dd-item ">
        <a href="/010_introduction/18_getting_started.html">
        Getting Started
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/020_event_engine_setup.html" title="Event Engine Setup" class="dd-item
        
        
        
        ">
      <a href="/020_event_engine_setup.html">
          Event Engine Setup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/020_event_engine_setup/20_aws_event_engine.html" title="1. AWS Event Engine" class="dd-item ">
        <a href="/020_event_engine_setup/20_aws_event_engine.html">
        1. AWS Event Engine
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/020_event_engine_setup/22_setup_eks.html" title="2. Set up EKS Cluster" class="dd-item ">
        <a href="/020_event_engine_setup/22_setup_eks.html">
        2. Set up EKS Cluster
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/030_aws_setup_for_hosting_kong.html" title="AWS Setup for Hosting Kong" class="dd-item
        
        
        
        ">
      <a href="/030_aws_setup_for_hosting_kong.html">
          AWS Setup for Hosting Kong
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/030_aws_setup_for_hosting_kong/30_provisiong_eks_infrastructure.html" title="Provisioning EKS infrastructure" class="dd-item ">
        <a href="/030_aws_setup_for_hosting_kong/30_provisiong_eks_infrastructure.html">
        Provisioning EKS infrastructure
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/040_kong_enterprise_setup.html" title="Kong Konnect Enterprise Set Up" class="dd-item
        parent
        
        
        ">
      <a href="/040_kong_enterprise_setup.html">
          Kong Konnect Enterprise Set Up
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/041_data_plane_and_control_plane_setup.html" title="Konnect Control Plane and Data Plane Setup" class="dd-item ">
        <a href="/040_kong_enterprise_setup/041_data_plane_and_control_plane_setup.html">
        Konnect Control Plane and Data Plane Setup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/042_hpa.html" title="Konnect Data Plane Elasticity" class="dd-item active">
        <a href="/040_kong_enterprise_setup/042_hpa.html">
        Konnect Data Plane Elasticity
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/043_prometheus_grafana.html" title="Prometheus and Grafana" class="dd-item ">
        <a href="/040_kong_enterprise_setup/043_prometheus_grafana.html">
        Prometheus and Grafana
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/044_elk.html" title="ELK Stack" class="dd-item ">
        <a href="/040_kong_enterprise_setup/044_elk.html">
        ELK Stack
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/045_redis.html" title="Redis" class="dd-item ">
        <a href="/040_kong_enterprise_setup/045_redis.html">
        Redis
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/046_sample_application.html" title="Sample App Installation" class="dd-item ">
        <a href="/040_kong_enterprise_setup/046_sample_application.html">
        Sample App Installation
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/047_simple_kong_ingress.html" title="Simple Kong Ingress" class="dd-item ">
        <a href="/040_kong_enterprise_setup/047_simple_kong_ingress.html">
        Simple Kong Ingress
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/050_kong_ingress_consumption_monitoring.html" title="Kong Ingress Consumption and Monitoring" class="dd-item
        
        
        
        ">
      <a href="/050_kong_ingress_consumption_monitoring.html">
          Kong Ingress Consumption and Monitoring
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/050_kong_ingress_consumption_monitoring/051_prometheus_grafana.html" title="Prometheus and Grafana" class="dd-item ">
        <a href="/050_kong_ingress_consumption_monitoring/051_prometheus_grafana.html">
        Prometheus and Grafana
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/050_kong_ingress_consumption_monitoring/052_elk.html" title="ELK" class="dd-item ">
        <a href="/050_kong_ingress_consumption_monitoring/052_elk.html">
        ELK
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/060_kong_ingress.html" title="Kong Ingress Controller Policies" class="dd-item
        
        
        
        ">
      <a href="/060_kong_ingress.html">
          Kong Ingress Controller Policies
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/061_cache.html" title="Proxy Caching" class="dd-item ">
        <a href="/060_kong_ingress/061_cache.html">
        Proxy Caching
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/063_rate_limiting.html" title="Rate Limiting Policy Definition" class="dd-item ">
        <a href="/060_kong_ingress/063_rate_limiting.html">
        Rate Limiting Policy Definition
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/064_api_key.html" title="API Key Policy Definition" class="dd-item ">
        <a href="/060_kong_ingress/064_api_key.html">
        API Key Policy Definition
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/065_ingress_rule.html" title="Set up Ingress rule for Kong Ingress" class="dd-item ">
        <a href="/060_kong_ingress/065_ingress_rule.html">
        Set up Ingress rule for Kong Ingress
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/066_fallback_service.html" title="Configuring a fallback service" class="dd-item ">
        <a href="/060_kong_ingress/066_fallback_service.html">
        Configuring a fallback service
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/067_https_redirect.html" title="HTTP/S Redirect" class="dd-item ">
        <a href="/060_kong_ingress/067_https_redirect.html">
        HTTP/S Redirect
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/068_redis_ratelimiting.html" title="Redis for Rate Limiting" class="dd-item ">
        <a href="/060_kong_ingress/068_redis_ratelimiting.html">
        Redis for Rate Limiting
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/070_kong_cognito.html" title="Kong and AWS Cognito" class="dd-item
        
        
        
        ">
      <a href="/070_kong_cognito.html">
          Kong and AWS Cognito
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/070_kong_cognito/071_cognito.html" title="AWS Cognito" class="dd-item ">
        <a href="/070_kong_cognito/071_cognito.html">
        AWS Cognito
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/070_kong_cognito/073_oidc_plugin.html" title="OpenId Connect Plugin" class="dd-item ">
        <a href="/070_kong_cognito/073_oidc_plugin.html">
        OpenId Connect Plugin
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/090_cleanup.html" title="Cleanup" class="dd-item
        
        
        
        ">
      <a href="/090_cleanup.html">
          Cleanup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3></h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://awsworkshop.io"><i class='fas fa-graduation-cap'></i> Modernization Workshops</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/builders-library/"><i class='fas fa-tools'></i> AWS Builders Library</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/blogs/modernizing-with-aws/"><i class='far fa-lightbulb'></i> Modernization with AWS</a>
              </li>
          
              <li>
                  <a class="padding" href="https://eksworkshop.com/"><i class='fas fa-chalkboard-teacher'></i> EKS Workshop</a>
              </li>
          
              <li>
                  <a class="padding" href="https://ecsworkshop.com/"><i class='fas fa-chalkboard-teacher'></i> ECS Workshop</a>
              </li>
          
              <li>
                  <a class="padding" href="https://www.appmeshworkshop.com/"><i class='fas fa-chalkboard-teacher'></i> App Mesh Workshop</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="oyo" value="/040_kong_enterprise_setup/042_hpa.html" selected>Self-Paced</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      

      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> </a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>

    <a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a
        href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | © 2020, Amazon Web Services, Inc. or its
    affiliates. All rights reserved.

</left>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>AWS Modernization Workshop</a> > <a href='/040_kong_enterprise_setup.html'>Kong Konnect Enterprise Set Up</a> > Konnect Data Plane Elasticity
          
        
          
        
          
        
                 
                  </span>
                </div>
                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
          <div id="chapter">
        
        <div id="body-inner">
          

        




<h1 id="konnect-data-plane-elasticity">Konnect Data Plane Elasticity</h1>

<p>One of the most important capabilities provided by Kubernetes is to easily scale out a Deployment. With a single command we can create or terminate pod replicas in order to optimaly support a given throughtput.</p>

<p>This capability is specially interesting for Kubernetes applications like Kong for Kubernetes Ingress Controller.</p>

<p>Here&rsquo;s our deployment before scaling it out:</p>
<pre tabindex="0"><code>$ kubectl get service -n kong-dp
NAME                 TYPE           CLUSTER-IP      EXTERNAL-IP                                                               PORT(S)                      AGE
kong-dp-kong-proxy   LoadBalancer   10.100.56.103   a946e3cab079a49a1b6661ab62d5585f-2135097986.us-east-1.elb.amazonaws.com   80:31032/TCP,443:30651/TCP   25m</code></pre>
<p>If we check our service, we&rsquo;ll see it has a single endpoint to IP address <b>192.168.16.247</b></p>
<pre tabindex="0"><code>$ kubectl describe service kong-dp-kong-proxy -n kong-dp
Name:                     kong-dp-kong-proxy
Namespace:                kong-dp
Labels:                   app.kubernetes.io/instance=kong-dp
                          app.kubernetes.io/managed-by=Helm
                          app.kubernetes.io/name=kong
                          app.kubernetes.io/version=2.5
                          enable-metrics=true
                          helm.sh/chart=kong-2.3.0
Annotations:              meta.helm.sh/release-name: kong-dp
                          meta.helm.sh/release-namespace: kong-dp
Selector:                 app.kubernetes.io/component=app,app.kubernetes.io/instance=kong-dp,app.kubernetes.io/name=kong
Type:                     LoadBalancer
IP Family Policy:         SingleStack
IP Families:              IPv4
IP:                       10.100.56.103
IPs:                      10.100.56.103
LoadBalancer Ingress:     a946e3cab079a49a1b6661ab62d5585f-2135097986.us-east-1.elb.amazonaws.com
Port:                     kong-proxy  80/TCP
TargetPort:               8000/TCP
NodePort:                 kong-proxy  31032/TCP
Endpoints:                192.168.32.5:8000
Port:                     kong-proxy-tls  443/TCP
TargetPort:               8443/TCP
NodePort:                 kong-proxy-tls  30651/TCP
Endpoints:                192.168.32.5:8443
Session Affinity:         None
External Traffic Policy:  Cluster
Events:
  Type    Reason                Age   From                Message
  ----    ------                ----  ----                -------
  Normal  EnsuringLoadBalancer  25m   service-controller  Ensuring load balancer
  Normal  EnsuredLoadBalancer   25m   service-controller  Ensured load balancer</code></pre>
<p>In fact, this is the Pod&rsquo;s IP adress of our Data Plane. You can check it out.</p>
<pre tabindex="0"><code>$ kubectl get pod -n kong-dp -o wide
NAME                            READY   STATUS    RESTARTS   AGE   IP             NODE                             NOMINATED NODE   READINESS GATES
kong-dp-kong-848f4984dc-zshwv   1/1     Running   0          25m   192.168.32.5   ip-192-168-42-135.ec2.internal   &lt;none&gt;           &lt;none&gt;</code></pre>
<h2 id="manual-scaling-out">Manual Scaling Out</h2>

<p>Now, let&rsquo;s scale the deployment out creating 3 replicas of our Pod</p>
<pre tabindex="0"><code>kubectl scale deployment.v1.apps/kong-dp-kong -n kong-dp --replicas=3</code></pre>
<p>Check the Deployment again:</p>
<pre tabindex="0"><code>$ kubectl get pod -n kong-dp -o wide
NAME                            READY   STATUS    RESTARTS   AGE   IP               NODE                             NOMINATED NODE   READINESS GATES
kong-dp-kong-848f4984dc-8gc9r   1/1     Running   0          10s   192.168.38.129   ip-192-168-42-135.ec2.internal   &lt;none&gt;           &lt;none&gt;
kong-dp-kong-848f4984dc-dqltw   1/1     Running   0          10s   192.168.48.245   ip-192-168-42-135.ec2.internal   &lt;none&gt;           &lt;none&gt;
kong-dp-kong-848f4984dc-zshwv   1/1     Running   0          26m   192.168.32.5     ip-192-168-42-135.ec2.internal   &lt;none&gt;           &lt;none&gt;</code></pre>
<p>As we can see, the 2 new Pods have been created and are up and running. If we check our Kubernetes Service again, we&rsquo;ll see it has been updated with the new IP addresses. That allows the Service to implement Load Balancing across the Pod replicas.</p>
<pre tabindex="0"><code>$ kubectl describe service kong-dp-kong-proxy -n kong-dp
Name:                     kong-dp-kong-proxy
Namespace:                kong-dp
Labels:                   app.kubernetes.io/instance=kong-dp
                          app.kubernetes.io/managed-by=Helm
                          app.kubernetes.io/name=kong
                          app.kubernetes.io/version=2.5
                          enable-metrics=true
                          helm.sh/chart=kong-2.3.0
Annotations:              meta.helm.sh/release-name: kong-dp
                          meta.helm.sh/release-namespace: kong-dp
Selector:                 app.kubernetes.io/component=app,app.kubernetes.io/instance=kong-dp,app.kubernetes.io/name=kong
Type:                     LoadBalancer
IP Family Policy:         SingleStack
IP Families:              IPv4
IP:                       10.100.56.103
IPs:                      10.100.56.103
LoadBalancer Ingress:     a946e3cab079a49a1b6661ab62d5585f-2135097986.us-east-1.elb.amazonaws.com
Port:                     kong-proxy  80/TCP
TargetPort:               8000/TCP
NodePort:                 kong-proxy  31032/TCP
Endpoints:                192.168.32.5:8000,192.168.38.129:8000,192.168.48.245:8000
Port:                     kong-proxy-tls  443/TCP
TargetPort:               8443/TCP
NodePort:                 kong-proxy-tls  30651/TCP
Endpoints:                192.168.32.5:8443,192.168.38.129:8443,192.168.48.245:8443
Session Affinity:         None
External Traffic Policy:  Cluster
Events:
  Type    Reason                Age   From                Message
  ----    ------                ----  ----                -------
  Normal  EnsuringLoadBalancer  26m   service-controller  Ensuring load balancer
  Normal  EnsuredLoadBalancer   26m   service-controller  Ensured load balancer</code></pre>
<p>Reduce the number of Pods to 1 again running:</p>
<pre tabindex="0"><code>kubectl scale deployment.v1.apps/kong-dp-kong -n kong-dp --replicas=1</code></pre>
<h2 id="hpa-horizontal-autoscaler">HPA - Horizontal Autoscaler</h2>

<p>HPA (“Horizontal Pod Autoscaler”) is the Kubernetes resource to automatically control the number of replicas of Pods. With HPA, Kubernetes is able to support the requests produced by the consumers, keeping a given Service Level.</p>

<p>Based on CPU utilization or custom metrics, HPA starts and terminates Pods replicas updating all service data to help on the load balancing policies over those replicas.</p>

<p>HPA is described at <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank">https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/</a>. Also, there&rsquo;s a nice walkthrough at <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/" target="_blank">https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/</a></p>

<p>Kubernetes defines its own units for cpu and memory. You can read more about it at: <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/" target="_blank">https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/</a>. We use these units to set our Deployments with HPA.</p>

<h3 id="install-metrics-server">Install Metrics Server</h3>
<pre tabindex="0"><code>kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</code></pre><pre tabindex="0"><code>$ kubectl get pod -n kube-system
NAME                              READY   STATUS    RESTARTS   AGE
aws-node-kr2c4                    1/1     Running   0          15h
coredns-66cb55d4f4-8pwrn          1/1     Running   0          15h
coredns-66cb55d4f4-hw4mq          1/1     Running   0          15h
kube-proxy-gb8bc                  1/1     Running   0          15h
metrics-server-7b9c4d7fd9-fwlvq   1/1     Running   0          31s</code></pre>
<h3 id="turn-hpa-on">Turn HPA on</h3>

<p>Still using Helm, let&rsquo;s upgrade our Data Plane deployment including new and specific settings for HPA:</p>
<pre tabindex="0"><code>....
--set resources.requests.cpu=&#34;300m&#34; \
--set resources.requests.memory=&#34;300Mi&#34; \
--set resources.limits.cpu=&#34;1200m&#34; \
--set resources.limits.memory=&#34;800Mi&#34; \
--set autoscaling.enabled=true \
--set autoscaling.minReplicas=1 \
--set autoscaling.maxReplicas=20 \
--set autoscaling.metrics[0].type=Resource \
--set autoscaling.metrics[0].resource.name=cpu \
--set autoscaling.metrics[0].resource.target.type=Utilization \
--set autoscaling.metrics[0].resource.target.averageUtilization=75</code></pre>
<p>The new settings are defining the ammount of CPU and memory each Pod should allocate. At the same time, the &ldquo;autoscaling&rdquo; sets are telling HPA how to proceed to instantiate new Pod replicas.</p>

<p>Here&rsquo;s the final Helm command:</p>
<pre tabindex="0"><code>helm upgrade kong-dp kong/kong -n kong-dp \
--set ingressController.enabled=false \
--set image.repository=kong/kong-gateway \
--set image.tag=2.5.1.0-alpine \
--set env.database=off \
--set env.role=data_plane \
--set env.cluster_cert=/etc/secrets/kong-cluster-cert/tls.crt \
--set env.cluster_cert_key=/etc/secrets/kong-cluster-cert/tls.key \
--set env.lua_ssl_trusted_certificate=/etc/secrets/kong-cluster-cert/tls.crt \
--set env.cluster_control_plane=kong-kong-cluster.kong.svc.cluster.local:8005 \
--set env.cluster_telemetry_endpoint=kong-kong-clustertelemetry.kong.svc.cluster.local:8006 \
--set proxy.enabled=true \
--set proxy.type=LoadBalancer \
--set enterprise.enabled=true \
--set enterprise.license_secret=kong-enterprise-license \
--set enterprise.portal.enabled=false \
--set enterprise.rbac.enabled=false \
--set enterprise.smtp.enabled=false \
--set manager.enabled=false \
--set portal.enabled=false \
--set portalapi.enabled=false \
--set env.status_listen=0.0.0.0:8100 \
--set secretVolumes[0]=kong-cluster-cert \
--set resources.requests.cpu=&#34;300m&#34; \
--set resources.requests.memory=&#34;300Mi&#34; \
--set resources.limits.cpu=&#34;1200m&#34; \
--set resources.limits.memory=&#34;800Mi&#34; \
--set autoscaling.enabled=true \
--set autoscaling.minReplicas=1 \
--set autoscaling.maxReplicas=20 \
--set autoscaling.metrics[0].type=Resource \
--set autoscaling.metrics[0].resource.name=cpu \
--set autoscaling.metrics[0].resource.target.type=Utilization \
--set autoscaling.metrics[0].resource.target.averageUtilization=75</code></pre>
<h3 id="checking-hpa">Checking HPA</h3>

<p>After submitting the command check the Deployment again. Since we&rsquo;re not consume the Data Plane, we are supposed to see a single Pod running. In the next sections we&rsquo;re going to send requests to the Data Plane and new Pod will get created to handle them.</p>
<pre tabindex="0"><code>$ kubectl get pod -n kong-dp
NAME                            READY   STATUS        RESTARTS   AGE
kong-dp-kong-67995ddc8c-4vhph   1/1     Running       0          14s</code></pre>
<p>You can check the HPA status with:</p>
<pre tabindex="0"><code>$ kubectl get hpa -n kong-dp
NAME           REFERENCE                 TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
kong-dp-kong   Deployment/kong-dp-kong   0%/75%    1         20        1          46s</code></pre>
<p>If you want to change the policy run, for example:</p>
<pre tabindex="0"><code>kubectl -n kong-dp patch hpa kong-dp-kong --patch &#39;{&#34;spec&#34;:{&#34;targetCPUUtilizationPercentage&#34;:60}}&#39;</code></pre>
<p>or</p>
<pre tabindex="0"><code>kubectl -n kong-dp patch hpa kong-dp-kong --patch &#39;{&#34;spec&#34;:{&#34;maxReplicas&#34;:15}}&#39;</code></pre>
<h3 id="turn-hpa-off">Turn HPA off</h3>

<p>If you want to turn HPA on we just have to run another Helm upgrade against our Deployment:</p>
<pre tabindex="0"><code>helm upgrade kong-dp kong/kong -n kong-dp \
--set ingressController.enabled=false \
--set image.repository=kong/kong-gateway \
--set image.tag=2.5.1.0-alpine \
--set env.database=off \
--set env.role=data_plane \
--set env.cluster_cert=/etc/secrets/kong-cluster-cert/tls.crt \
--set env.cluster_cert_key=/etc/secrets/kong-cluster-cert/tls.key \
--set env.lua_ssl_trusted_certificate=/etc/secrets/kong-cluster-cert/tls.crt \
--set env.cluster_control_plane=kong-kong-cluster.kong.svc.cluster.local:8005 \
--set env.cluster_telemetry_endpoint=kong-kong-clustertelemetry.kong.svc.cluster.local:8006 \
--set proxy.enabled=true \
--set proxy.type=LoadBalancer \
--set enterprise.enabled=true \
--set enterprise.portal.enabled=false \
--set enterprise.rbac.enabled=false \
--set enterprise.smtp.enabled=false \
--set manager.enabled=false \
--set portal.enabled=false \
--set portalapi.enabled=false \
--set env.status_listen=0.0.0.0:8100 \
--set secretVolumes[0]=kong-cluster-cert</code></pre>
<p>or deleting the HPA with kubectl</p>
<pre tabindex="0"><code>kubectl delete hpa kong-dp-kong -n kong-dp</code></pre>
<p>Leave the HPA set so we can see it in action when sending requests to the Data Plane.</p>


<footer class="footline">
	
</footer>

        
            </div> 
        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/040_kong_enterprise_setup/041_data_plane_and_control_plane_setup.html" title="Konnect Control Plane and Data Plane Setup"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/040_kong_enterprise_setup/043_prometheus_grafana.html" title="Prometheus and Grafana" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1633693366"></script>
    <script src="/js/perfect-scrollbar.min.js?1633693366"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1633693366"></script>
    <script src="/js/jquery.sticky.js?1633693366"></script>
    <script src="/js/featherlight.min.js?1633693366"></script>
    <script src="/js/highlight.pack.js?1633693366"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1633693366"></script>
    <script src="/js/learn.js?1633693366"></script>
    <script src="/js/hugo-learn.js?1633693366"></script>
    
        
            <script src="/mermaid/mermaid.js?1633693366"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

