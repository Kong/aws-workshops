<!DOCTYPE html>
<html lang="oyo" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.88.1" />
    <meta name="description" content="AWS Modernization Workshop with Kong">
<meta name="author" content="Eugene Mu, Thomas McGonagle, Peter Blinstrubas">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Konnect Control Plane and Data Plane Setup :: Self-Paced</title>

    
    <link href="/css/nucleus.css?1633693366" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1633693366" rel="stylesheet">
    <link href="/css/hybrid.css?1633693366" rel="stylesheet">
    <link href="/css/featherlight.min.css?1633693366" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1633693366" rel="stylesheet">
    <link href="/css/auto-complete.css?1633693366" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1633693366" rel="stylesheet">
    <link href="/css/theme.css?1633693366" rel="stylesheet">
    <link href="/css/tabs.css?1633693366" rel="stylesheet">
    <link href="/css/hugo-theme.css?1633693366" rel="stylesheet">
    
    <link href="/css/theme-mine.css?1633693366" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1633693366"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <script type="text/javascript">
    (function() {
          var didInit = false;
          function initMunchkin() {
              if (didInit === false) {
                didInit = true;
                Munchkin.init("112-TZM-766", { domainLevel: 3 });
              }
          }
          var s = document.createElement('script');
          s.type = 'text/javascript';
          s.async = true;
          s.src = '//munchkin.marketo.net/munchkin.js';
          s.onreadystatechange = function() {
              if (this.readyState == 'complete' || this.readyState == 'loaded') {
                  initMunchkin();
              }
          };
          s.onload = initMunchkin;
          document.getElementsByTagName('head')[0].appendChild(s);
    })();
</script>

<link rel="stylesheet" href="/css/mp-devops-series.css">
<link rel="stylesheet" href="https://pages.awscloud.com/js/forms2/css/forms2.css">

  </head>
  <body class="" data-url="/040_kong_enterprise_setup/041_data_plane_and_control_plane_setup.html">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a href="/" title="Go home"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 30" width="60%" style="padding:20px 0px;"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg></a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1633693366"></script>
<script type="text/javascript" src="/js/auto-complete.js?1633693366"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1633693366"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/010_introduction.html" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="/010_introduction.html">
          Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/10_foreword.html" title="Foreword" class="dd-item ">
        <a href="/010_introduction/10_foreword.html">
        Foreword
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/12_problem_to_solve.html" title="The Challenge" class="dd-item ">
        <a href="/010_introduction/12_problem_to_solve.html">
        The Challenge
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/14_partner.html" title="What is Kong?" class="dd-item ">
        <a href="/010_introduction/14_partner.html">
        What is Kong?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/16_workshop_prerequisites.html" title="Workshop Prerequisites" class="dd-item ">
        <a href="/010_introduction/16_workshop_prerequisites.html">
        Workshop Prerequisites
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_introduction/18_getting_started.html" title="Getting Started" class="dd-item ">
        <a href="/010_introduction/18_getting_started.html">
        Getting Started
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/020_event_engine_setup.html" title="Event Engine Setup" class="dd-item
        
        
        
        ">
      <a href="/020_event_engine_setup.html">
          Event Engine Setup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/020_event_engine_setup/20_aws_event_engine.html" title="1. AWS Event Engine" class="dd-item ">
        <a href="/020_event_engine_setup/20_aws_event_engine.html">
        1. AWS Event Engine
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/020_event_engine_setup/22_setup_eks.html" title="2. Set up EKS Cluster" class="dd-item ">
        <a href="/020_event_engine_setup/22_setup_eks.html">
        2. Set up EKS Cluster
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/030_aws_setup_for_hosting_kong.html" title="AWS Setup for Hosting Kong" class="dd-item
        
        
        
        ">
      <a href="/030_aws_setup_for_hosting_kong.html">
          AWS Setup for Hosting Kong
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/030_aws_setup_for_hosting_kong/30_provisiong_eks_infrastructure.html" title="Provisioning EKS infrastructure" class="dd-item ">
        <a href="/030_aws_setup_for_hosting_kong/30_provisiong_eks_infrastructure.html">
        Provisioning EKS infrastructure
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/040_kong_enterprise_setup.html" title="Kong Konnect Enterprise Set Up" class="dd-item
        parent
        
        
        ">
      <a href="/040_kong_enterprise_setup.html">
          Kong Konnect Enterprise Set Up
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/041_data_plane_and_control_plane_setup.html" title="Konnect Control Plane and Data Plane Setup" class="dd-item active">
        <a href="/040_kong_enterprise_setup/041_data_plane_and_control_plane_setup.html">
        Konnect Control Plane and Data Plane Setup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/042_hpa.html" title="Konnect Data Plane Elasticity" class="dd-item ">
        <a href="/040_kong_enterprise_setup/042_hpa.html">
        Konnect Data Plane Elasticity
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/043_prometheus_grafana.html" title="Prometheus and Grafana" class="dd-item ">
        <a href="/040_kong_enterprise_setup/043_prometheus_grafana.html">
        Prometheus and Grafana
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/044_elk.html" title="ELK Stack" class="dd-item ">
        <a href="/040_kong_enterprise_setup/044_elk.html">
        ELK Stack
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/045_redis.html" title="Redis" class="dd-item ">
        <a href="/040_kong_enterprise_setup/045_redis.html">
        Redis
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/046_sample_application.html" title="Sample App Installation" class="dd-item ">
        <a href="/040_kong_enterprise_setup/046_sample_application.html">
        Sample App Installation
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/040_kong_enterprise_setup/047_simple_kong_ingress.html" title="Simple Kong Ingress" class="dd-item ">
        <a href="/040_kong_enterprise_setup/047_simple_kong_ingress.html">
        Simple Kong Ingress
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/050_kong_ingress_consumption_monitoring.html" title="Kong Ingress Consumption and Monitoring" class="dd-item
        
        
        
        ">
      <a href="/050_kong_ingress_consumption_monitoring.html">
          Kong Ingress Consumption and Monitoring
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/050_kong_ingress_consumption_monitoring/051_prometheus_grafana.html" title="Prometheus and Grafana" class="dd-item ">
        <a href="/050_kong_ingress_consumption_monitoring/051_prometheus_grafana.html">
        Prometheus and Grafana
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/050_kong_ingress_consumption_monitoring/052_elk.html" title="ELK" class="dd-item ">
        <a href="/050_kong_ingress_consumption_monitoring/052_elk.html">
        ELK
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/060_kong_ingress.html" title="Kong Ingress Controller Policies" class="dd-item
        
        
        
        ">
      <a href="/060_kong_ingress.html">
          Kong Ingress Controller Policies
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/061_cache.html" title="Proxy Caching" class="dd-item ">
        <a href="/060_kong_ingress/061_cache.html">
        Proxy Caching
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/063_rate_limiting.html" title="Rate Limiting Policy Definition" class="dd-item ">
        <a href="/060_kong_ingress/063_rate_limiting.html">
        Rate Limiting Policy Definition
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/064_api_key.html" title="API Key Policy Definition" class="dd-item ">
        <a href="/060_kong_ingress/064_api_key.html">
        API Key Policy Definition
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/065_ingress_rule.html" title="Set up Ingress rule for Kong Ingress" class="dd-item ">
        <a href="/060_kong_ingress/065_ingress_rule.html">
        Set up Ingress rule for Kong Ingress
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/066_fallback_service.html" title="Configuring a fallback service" class="dd-item ">
        <a href="/060_kong_ingress/066_fallback_service.html">
        Configuring a fallback service
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/067_https_redirect.html" title="HTTP/S Redirect" class="dd-item ">
        <a href="/060_kong_ingress/067_https_redirect.html">
        HTTP/S Redirect
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/060_kong_ingress/068_redis_ratelimiting.html" title="Redis for Rate Limiting" class="dd-item ">
        <a href="/060_kong_ingress/068_redis_ratelimiting.html">
        Redis for Rate Limiting
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/070_kong_cognito.html" title="Kong and AWS Cognito" class="dd-item
        
        
        
        ">
      <a href="/070_kong_cognito.html">
          Kong and AWS Cognito
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/070_kong_cognito/071_cognito.html" title="AWS Cognito" class="dd-item ">
        <a href="/070_kong_cognito/071_cognito.html">
        AWS Cognito
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/070_kong_cognito/073_oidc_plugin.html" title="OpenId Connect Plugin" class="dd-item ">
        <a href="/070_kong_cognito/073_oidc_plugin.html">
        OpenId Connect Plugin
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/090_cleanup.html" title="Cleanup" class="dd-item
        
        
        
        ">
      <a href="/090_cleanup.html">
          Cleanup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3></h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://awsworkshop.io"><i class='fas fa-graduation-cap'></i> Modernization Workshops</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/builders-library/"><i class='fas fa-tools'></i> AWS Builders Library</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/blogs/modernizing-with-aws/"><i class='far fa-lightbulb'></i> Modernization with AWS</a>
              </li>
          
              <li>
                  <a class="padding" href="https://eksworkshop.com/"><i class='fas fa-chalkboard-teacher'></i> EKS Workshop</a>
              </li>
          
              <li>
                  <a class="padding" href="https://ecsworkshop.com/"><i class='fas fa-chalkboard-teacher'></i> ECS Workshop</a>
              </li>
          
              <li>
                  <a class="padding" href="https://www.appmeshworkshop.com/"><i class='fas fa-chalkboard-teacher'></i> App Mesh Workshop</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="oyo" value="/040_kong_enterprise_setup/041_data_plane_and_control_plane_setup.html" selected>Self-Paced</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      

      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> </a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>

    <a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a
        href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | © 2020, Amazon Web Services, Inc. or its
    affiliates. All rights reserved.

</left>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>AWS Modernization Workshop</a> > <a href='/040_kong_enterprise_setup.html'>Kong Konnect Enterprise Set Up</a> > Konnect Control Plane and Data Plane Setup
          
        
          
        
          
        
                 
                  </span>
                </div>
                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
          <div id="chapter">
        
        <div id="body-inner">
          

        




<h1 id="konnect-control-plane-and-data-plane">Konnect Control Plane and Data Plane</h1>

<h2 id="create-the-digital-certificate-and-private-key-pair">Create the Digital Certificate and Private Key pair</h2>

<p>In Hybrid mode, a mutual TLS handshake (mTLS) is used for authentication so the actual private key is never transferred on the network, and communication between CP and DP nodes is secure.<br><br></p>

<p>Before using Hybrid mode, you need a certificate/key pair. Kong Gateway provides two modes for handling certificate/key pairs:<br><br></p>

<ul>
<li><b>Shared mode</b>: (Default) Use the Kong CLI to generate a certificate/key pair, then distribute copies across nodes. The certificate/key pair is shared by both CP and DP nodes.<br></li>
<li><b>PKI mode</b>: Provide certificates signed by a central certificate authority (CA). Kong validates both sides by checking if they are from the same CA. This eliminates the risks associated with transporting private keys.<br><br></li>
</ul>

<p>To have an easier deployment we&rsquo;re going to use the Shared Mode and OpenSSL to issue the pair. The command below creates two files &ldquo;cluster.key&rdquo; and &ldquo;cluster.crt&rdquo;.</p>

<pre>
openssl req -new -x509 -nodes -newkey ec:<(openssl ecparam -name secp384r1) \
  -keyout ./cluster.key -out ./cluster.crt \
  -days 1095 -subj "/CN=kong_clustering"
</pre>

<h2 id="configure-kong-konnect-helm-charts-to-install-the-control-plane-and-data-plane">Configure Kong Konnect Helm Charts to install the Control Plane and Data Plane</h2>

<p>Before installing the Control Plane make sure you have Helm installed locally:
<pre>
$ helm version
version.BuildInfo{Version:&ldquo;v3.7.0&rdquo;, GitCommit:&ldquo;eeac83883cb4014fe60267ec6373570374ce770b&rdquo;, GitTreeState:&ldquo;clean&rdquo;, GoVersion:&ldquo;go1.17&rdquo;}
</pre></p>

<p>Now add Kong Helm Charts repo:
<pre>
$ helm repo add kong <a href="https://charts.kong.com" target="_blank">https://charts.kong.com</a>
&ldquo;kong&rdquo; has been added to your repositories
</pre></p>

<p>You should see it:
<pre>
$ helm repo ls
NAME    URL<br />
kong    <a href="https://charts.konghq.com" target="_blank">https://charts.konghq.com</a>
</pre></p>

<p>If you want to update it run:
<pre>
$ helm repo update
Hang tight while we grab the latest from your chart repositories&hellip;
&hellip;Successfully got an update from the &ldquo;kong&rdquo; chart repository
Update Complete. ⎈ Happy Helming!⎈
</pre></p>

<h2 id="control-plane">Control Plane</h2>

<p>Let&rsquo;s get started deploying the Kong Konnect Control Plane. First of all, create a &ldquo;kong&rdquo; namespace:
<pre>
kubectl create namespace kong
</pre></p>

<h3 id="create-a-kubernetes-secret-with-the-pair">Create a Kubernetes secret with the pair</h3>

<pre>
kubectl create secret tls kong-cluster-cert \-\-cert=./cluster.crt \-\-key=./cluster.key -n kong
</pre>

<h3 id="create-a-secret-with-your-license-file">Create a secret with your license file</h3>

<pre>
kubectl create secret generic kong-enterprise-license -n kong --from-file=./license
</pre>

<h3 id="create-a-b-admin-gui-session-conf-b-file-for-kong-manager-session-conf">Create a <b>&ldquo;admin_gui.session_conf&rdquo;</b> file for Kong Manager session conf.</h3>

<pre>
{"cookie_name":"admin_session","cookie_samesite":"off","secret":"kong","cookie_secure":false,"storage":"kong"}
</pre>

<h3 id="create-a-b-portal-session-conf-b-file-for-for-kong-devportal-session-conf">Create a <b>&ldquo;portal_session_conf&rdquo;</b> file for for Kong DevPortal session conf</h3>

<pre>
{"cookie_name":"portal_session","cookie_samesite":"off","secret":"kong","cookie_secure":false,"storage":"kong"}
</pre>

<p>Create the session conf with kubectl
<pre>
kubectl create secret generic kong-session-config -n kong &ndash;from-file=admin_gui_session_conf &ndash;from-file=portal_session_conf
</pre></p>

<h3 id="deploy-the-control-plane">Deploy the Control Plane</h3>

<p>helm install kong kong/kong -n kong <br />
&ndash;set env.database=postgres <br />
&ndash;set env.role=control_plane <br />
&ndash;set env.cluster_cert=/etc/secrets/kong-cluster-cert/tls.crt <br />
&ndash;set env.cluster_cert_key=/etc/secrets/kong-cluster-cert/tls.key <br />
&ndash;set cluster.enabled=true <br />
&ndash;set cluster.tls.enabled=true <br />
&ndash;set cluster.tls.servicePort=8005 <br />
&ndash;set cluster.tls.containerPort=8005 <br />
&ndash;set clustertelemetry.enabled=true <br />
&ndash;set clustertelemetry.tls.enabled=true <br />
&ndash;set clustertelemetry.tls.servicePort=8006 <br />
&ndash;set clustertelemetry.tls.containerPort=8006 <br />
&ndash;set image.repository=kong/kong-gateway <br />
&ndash;set image.tag=2.5.1.0-alpine <br />
&ndash;set admin.enabled=true <br />
&ndash;set admin.http.enabled=true <br />
&ndash;set admin.type=LoadBalancer <br />
&ndash;set proxy.enabled=true <br />
&ndash;set proxy.type=ClusterIP <br />
&ndash;set ingressController.enabled=true <br />
&ndash;set ingressController.installCRDs=false <br />
&ndash;set ingressController.image.repository=kong/kubernetes-ingress-controller <br />
&ndash;set ingressController.image.tag=1.3.2-alpine <br />
&ndash;set postgresql.enabled=true <br />
&ndash;set postgresql.postgresqlUsername=kong <br />
&ndash;set postgresql.postgresqlDatabase=kong <br />
&ndash;set postgresql.postgresqlPassword=kong <br />
&ndash;set enterprise.enabled=true <br />
&ndash;set enterprise.license_secret=kong-enterprise-license <br />
&ndash;set enterprise.rbac.enabled=false <br />
&ndash;set enterprise.smtp.enabled=false <br />
&ndash;set enterprise.portal.enabled=true <br />
&ndash;set manager.enabled=true <br />
&ndash;set manager.type=LoadBalancer <br />
&ndash;set portal.enabled=true <br />
&ndash;set portal.http.enabled=true <br />
&ndash;set env.portal_gui_protocol=http <br />
&ndash;set portal.type=LoadBalancer <br />
&ndash;set portalapi.enabled=true <br />
&ndash;set portalapi.http.enabled=true <br />
&ndash;set portalapi.type=LoadBalancer <br />
&ndash;set secretVolumes[0]=kong-cluster-cert</p>

<p>Control Plane uses port 8005 to publish any new API configuration it has. On the other hand, Data Plane uses the port 8006 to report back all metrics regarding API Consumption.</p>

<h2 id="data-plane">Data Plane</h2>

<p>Create another Kubernetes namespace specifically for the Data Plane:
<pre>
kubectl create namespace kong-dp
</pre></p>

<p>Create the secret for the Data Plane using the same Digital Certicate and Private Key pair:
<pre>
kubectl create secret tls kong-cluster-cert --cert=./cluster.crt --key=./cluster.key -n kong-dp
</pre></p>

<p>Create a secret with your license file
<pre>
kubectl create secret generic kong-enterprise-license -n kong-dp &ndash;from-file=./license
</pre></p>

<p>Install the Data Plane</p>

<pre>
helm install kong-dp kong/kong -n kong-dp \
--set ingressController.enabled=false \
--set image.repository=kong/kong-gateway \
--set image.tag=2.5.1.0-alpine \
--set env.database=off \
--set env.role=data_plane \
--set env.cluster_cert=/etc/secrets/kong-cluster-cert/tls.crt \
--set env.cluster_cert_key=/etc/secrets/kong-cluster-cert/tls.key \
--set env.lua_ssl_trusted_certificate=/etc/secrets/kong-cluster-cert/tls.crt \
--set env.cluster_control_plane=kong-kong-cluster.kong.svc.cluster.local:8005 \
--set env.cluster_telemetry_endpoint=kong-kong-clustertelemetry.kong.svc.cluster.local:8006 \
--set proxy.enabled=true \
--set proxy.type=LoadBalancer \
--set enterprise.enabled=true \
--set enterprise.license_secret=kong-enterprise-license \
--set enterprise.portal.enabled=false \
--set enterprise.rbac.enabled=false \
--set enterprise.smtp.enabled=false \
--set manager.enabled=false \
--set portal.enabled=false \
--set portalapi.enabled=false \
--set env.status_listen=0.0.0.0:8100 \
--set secretVolumes[0]=kong-cluster-cert
</pre>

<p>Note we&rsquo;re using the Control Plane&rsquo;s Kubernetes FQDN to get the Data Plane connected to it.</p>

<h2 id="checking-the-installation">Checking the Installation</h2>

<pre>
$ kubectl get deployment --all-namespaces
NAMESPACE     NAME           READY   UP-TO-DATE   AVAILABLE   AGE
kong-dp       kong-dp-kong   1/1     1            1           2m15s
kong          kong-kong      1/1     1            1           20m
kube-system   coredns        2/2     2            2           15h
</pre>

<pre>
$ kubectl get pod --all-namespaces
NAMESPACE     NAME                              READY   STATUS      RESTARTS   AGE
kong-dp       kong-dp-kong-848f4984dc-zshwv     1/1     Running     0          11m
kong          kong-kong-777b5f56bc-76k5v        2/2     Running     0          19m
kong          kong-kong-init-migrations-fwmg7   0/1     Completed   0          29m
kong          kong-postgresql-0                 1/1     Running     0          29m
kube-system   aws-node-kr2c4                    1/1     Running     0          15h
kube-system   coredns-66cb55d4f4-8pwrn          1/1     Running     0          15h
kube-system   coredns-66cb55d4f4-hw4mq          1/1     Running     0          15h
kube-system   kube-proxy-gb8bc                  1/1     Running     0          15h
</pre>

<pre>
$ kubectl get service --all-namespaces
NAMESPACE     NAME                         TYPE           CLUSTER-IP       EXTERNAL-IP                                                               PORT(S)                         AGE
default       kubernetes                   ClusterIP      10.100.0.1       <none>                                                                    443/TCP                         15h
kong-dp       kong-dp-kong-proxy           LoadBalancer   10.100.56.103    a946e3cab079a49a1b6661ab62d5585f-2135097986.us-east-1.elb.amazonaws.com   80:31032/TCP,443:30651/TCP      11m
kong          kong-kong-admin              LoadBalancer   10.100.124.36    a9ed78cc5bb954931aec1b5bf48298f6-2098365612.us-east-1.elb.amazonaws.com   8001:32155/TCP,8444:32134/TCP   29m
kong          kong-kong-cluster            ClusterIP      10.100.105.110   <none>                                                                    8005/TCP                        29m
kong          kong-kong-clustertelemetry   ClusterIP      10.100.192.124   <none>                                                                    8006/TCP                        29m
kong          kong-kong-manager            LoadBalancer   10.100.212.94    abd76df53f5584e8f800a9f9ac73d5fa-21140374.us-east-1.elb.amazonaws.com     8002:30693/TCP,8445:30219/TCP   29m
kong          kong-kong-portal             LoadBalancer   10.100.135.213   a4d6e108295f5458e9cffa00856c1fb2-1667372698.us-east-1.elb.amazonaws.com   8003:30474/TCP,8446:32207/TCP   29m
kong          kong-kong-portalapi          LoadBalancer   10.100.153.195   a0e9f107ba17749e5ac1542792a049f2-1349476423.us-east-1.elb.amazonaws.com   8004:31298/TCP,8447:30469/TCP   29m
kong          kong-kong-proxy              ClusterIP      10.100.205.134   <none>                                                                    80/TCP,443/TCP                  29m
kong          kong-postgresql              ClusterIP      10.100.10.254    <none>                                                                    5432/TCP                        29m
kong          kong-postgresql-headless     ClusterIP      None             <none>                                                                    5432/TCP                        29m
kube-system   kube-dns                     ClusterIP      10.100.0.10      <none>                                                                    53/UDP,53/TCP                   15h
</pre>

<h2 id="checking-the-kong-konnect-rest-admin-api-port">Checking the Kong Konnect Rest Admin API port</h2>

<p>Use the Load Balancer created during the deployment
<pre>
$ kubectl get service kong-kong-admin --output=jsonpath=&lsquo;{.status.loadBalancer.ingress[0].hostname}&rsquo; -n kong
a9ed78cc5bb954931aec1b5bf48298f6-2098365612.us-east-1.elb.amazonaws.com
</pre></p>

<pre>
$ http a9ed78cc5bb954931aec1b5bf48298f6-2098365612.us-east-1.elb.amazonaws.com:8001 | jq -r .version
2.5.1.0-enterprise-edition
</pre>

<h2 id="checking-the-data-plane-from-the-control-plane">Checking the Data Plane from the Control Plane</h2>

<pre>
$ http a9ed78cc5bb954931aec1b5bf48298f6-2098365612.us-east-1.elb.amazonaws.com:8001/clustering/status
HTTP/1.1 200 OK
Access-Control-Allow-Credentials: true
Access-Control-Allow-Origin: http://abd76df53f5584e8f800a9f9ac73d5fa-21140374.us-east-1.elb.amazonaws.com:8002
Connection: keep-alive
Content-Length: 177
Content-Type: application/json; charset=utf-8
Date: Thu, 30 Sep 2021 14:59:49 GMT
Deprecation: true
Server: kong/2.5.1.0-enterprise-edition
X-Kong-Admin-Latency: 3
X-Kong-Admin-Request-ID: ZG1HJrWBSgCDc2wz42DkGRwzZEDXF0Ia
vary: Origin

{
    "595ec021-5f64-4a10-ade2-0abdb9ffe444": {
        "config_hash": "b2c946b21b1a3c5bd3bc72ccdfc5cc78",
        "hostname": "kong-dp-kong-848f4984dc-zshwv",
        "ip": "192.168.32.5",
        "last_seen": 1633013975
    }
}
</pre>

<h2 id="checking-the-data-plane-proxy">Checking the Data Plane Proxy</h2>

<p>Use the Load Balancer created during the deployment</p>

<pre>
$ kubectl get svc -n kong-dp kong-dp-kong-proxy --output=jsonpath='{.status.loadBalancer.ingress[0].hostname}'
a946e3cab079a49a1b6661ab62d5585f-2135097986.us-east-1.elb.amazonaws.com
</pre>

<pre>
$ http a946e3cab079a49a1b6661ab62d5585f-2135097986.us-east-1.elb.amazonaws.com
HTTP/1.1 404 Not Found
Connection: keep-alive
Content-Length: 48
Content-Type: application/json; charset=utf-8
Date: Thu, 30 Sep 2021 15:00:35 GMT
Server: kong/2.5.1.0-enterprise-edition
X-Kong-Response-Latency: 0

{
    "message": "no Route matched with those values"
}
</pre>

<h2 id="configuring-kong-manager-service">Configuring Kong Manager Service</h2>

<p>Kong Manager is the Control Plane Admin GUI. It should get the Admin URI configured with the same Load Balancer address:
<pre>
kubectl patch deployment -n kong kong-kong -p &ldquo;{\&ldquo;spec\&rdquo;: { \&ldquo;template\&rdquo; : { \&ldquo;spec\&rdquo; : {\&ldquo;containers\&rdquo;:[{\&ldquo;name\&rdquo;:\&ldquo;proxy\&ldquo;,\&ldquo;env\&rdquo;: [{ \&ldquo;name\&rdquo; : \&ldquo;KONG_ADMIN_API_URI\&ldquo;, \&ldquo;value\&rdquo;: \&ldquo;a9ed78cc5bb954931aec1b5bf48298f6-2098365612.us-east-1.elb.amazonaws.com:8001\&rdquo; }]}]}}}}&rdquo;
</pre></p>

<pre>
kubectl patch deployment -n kong kong-kong -p "{\"spec\": { \"template\" : { \"spec\" : {\"containers\":[{\"name\":\"proxy\",\"env\": [{ \"name\" : \"KONG_ADMIN_GUI_URL\", \"value\": \"http:\/\/abd76df53f5584e8f800a9f9ac73d5fa-21140374.us-east-1.elb.amazonaws.com:8002\" }]}]}}}}"
</pre>

<h3 id="configuring-kong-dev-portal">Configuring Kong Dev Portal</h3>

<pre>
$ kubectl get service kong-kong-portalapi -n kong --output=jsonpath='{.status.loadBalancer.ingress[0].hostname}'
a0e9f107ba17749e5ac1542792a049f2-1349476423.us-east-1.elb.amazonaws.com
</pre>

<pre>
kubectl patch deployment -n kong kong-kong -p "{\"spec\": { \"template\" : { \"spec\" : {\"containers\":[{\"name\":\"proxy\",\"env\": [{ \"name\" : \"KONG_PORTAL_API_URL\", \"value\": \"http://a0e9f107ba17749e5ac1542792a049f2-1349476423.us-east-1.elb.amazonaws.com:8004\" }]}]}}}}"
</pre>

<pre>
$ kubectl get service kong-kong-portal -n kong --output=jsonpath='{.status.loadBalancer.ingress[0].hostname}'
a4d6e108295f5458e9cffa00856c1fb2-1667372698.us-east-1.elb.amazonaws.com
</pre>

<pre>
kubectl patch deployment -n kong kong-kong -p "{\"spec\": { \"template\" : { \"spec\" : {\"containers\":[{\"name\":\"proxy\",\"env\": [{ \"name\" : \"KONG_PORTAL_GUI_HOST\", \"value\": \"a4d6e108295f5458e9cffa00856c1fb2-1667372698.us-east-1.elb.amazonaws.com:8003\" }]}]}}}}"
</pre>

<h3 id="logging-to-kong-manager">Logging to Kong Manager</h3>

<p>Login to Kong Manager using the specific ELB:</p>

<pre>
$ kubectl get service kong-kong-manager -n kong --output=jsonpath='{.status.loadBalancer.ingress[0].hostname}'
abd76df53f5584e8f800a9f9ac73d5fa-21140374.us-east-1.elb.amazonaws.com
</pre>

<p>If you redirect your browser to <a href="http://abd76df53f5584e8f800a9f9ac73d5fa-21140374.us-east-1.elb.amazonaws.com:8002" target="_blank">http://abd76df53f5584e8f800a9f9ac73d5fa-21140374.us-east-1.elb.amazonaws.com:8002</a> you should see the Kong Manager landing page:</p>

<p><img src="/images/kong_manager.png" alt="kong_manager" /></p>

<h3 id="go-to-kong-developer-portal">Go to Kong Developer Portal</h3>

<p>Login to Kong Manager using the specific ELB:</p>


<footer class="footline">
	
</footer>

        
            </div> 
        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/040_kong_enterprise_setup.html" title="Kong Konnect Enterprise Set Up"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/040_kong_enterprise_setup/042_hpa.html" title="Konnect Data Plane Elasticity" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1633693366"></script>
    <script src="/js/perfect-scrollbar.min.js?1633693366"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1633693366"></script>
    <script src="/js/jquery.sticky.js?1633693366"></script>
    <script src="/js/featherlight.min.js?1633693366"></script>
    <script src="/js/highlight.pack.js?1633693366"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1633693366"></script>
    <script src="/js/learn.js?1633693366"></script>
    <script src="/js/hugo-learn.js?1633693366"></script>
    
        
            <script src="/mermaid/mermaid.js?1633693366"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

